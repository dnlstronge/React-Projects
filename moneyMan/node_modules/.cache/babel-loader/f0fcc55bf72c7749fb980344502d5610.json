{"ast":null,"code":"import _regeneratorRuntime from\"/home/dnlstronge/ReactP/moneyMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/dnlstronge/ReactP/moneyMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/dnlstronge/ReactP/moneyMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/dnlstronge/ReactP/moneyMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";//NEEDS TO:\n//add new docs to firestore collection\n//remove docs from firestore collection\nimport{useReducer,useEffect,useState}from\"react\";import{projectFirestore,timestamp}from'../firebase/config';var initialState={document:null,isPending:false,error:null,success:null};var firestoreReducer=function firestoreReducer(state,action){switch(action.type){//add cases to update state\ncase'IS_PENDING':return{isPending:true,document:null,success:false,error:null};case'ADDED_DOC':return{isPending:false,document:action.payload,success:true,error:null};case'DELETED_DOCUMENT':return{isPending:false,document:null,success:true,error:null};case'ERROR':return{isPending:false,document:null,success:false,error:action.payload};default:return state;}};export var useFirestore=function useFirestore(collection){var _useReducer=useReducer(firestoreReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),response=_useReducer2[0],dispatch=_useReducer2[1];// response = state\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),isCancelled=_useState2[0],setIsCancelled=_useState2[1];// for cleanup function on unmount\n//ref: collection - to be used for both adding and deleting\nvar ref=projectFirestore.collection(collection);// to dispatch if isCancelled is false: \nvar dispatchIfNotCancelled=function dispatchIfNotCancelled(action){if(!isCancelled){dispatch(action);}};// add doc:\nvar addDocument=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(doc){var createdAt,addedDocument;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch({type:'IS_PENDING'});// no data = no payload req\n_context.prev=1;createdAt=timestamp.fromDate(new Date());_context.next=5;return ref.add(_objectSpread(_objectSpread({},doc),{},{createdAt:createdAt}));case 5:addedDocument=_context.sent;dispatchIfNotCancelled({type:'ADDED_DOC',payload:addedDocument});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);dispatchIfNotCancelled({type:'ERROR',payload:_context.t0.message});case 12:case\"end\":return _context.stop();}}},_callee,null,[[1,9]]);}));return function addDocument(_x){return _ref.apply(this,arguments);};}();// delete doc:\nvar deleteDocument=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch({type:\"IS_PENDING\"});_context2.prev=1;_context2.next=4;return ref.doc(id).delete();case 4:dispatchIfNotCancelled({type:'DELETED_DOCUMENT'});_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](1);dispatchIfNotCancelled({type:'ERROR',payload:'Could not delete'});case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[1,7]]);}));return function deleteDocument(_x2){return _ref2.apply(this,arguments);};}();// cleanup function\nuseEffect(function(){return function(){setIsCancelled(true);};},[]);// only runs on mount due to empty dep array\nreturn{addDocument:addDocument,deleteDocument:deleteDocument,response:response};};","map":{"version":3,"names":["useReducer","useEffect","useState","projectFirestore","timestamp","initialState","document","isPending","error","success","firestoreReducer","state","action","type","payload","useFirestore","collection","response","dispatch","isCancelled","setIsCancelled","ref","dispatchIfNotCancelled","addDocument","doc","createdAt","fromDate","Date","add","addedDocument","message","deleteDocument","id","delete"],"sources":["/home/dnlstronge/ReactP/moneyMan/src/hooks/useFirestore.js"],"sourcesContent":["//NEEDS TO:\n\n//add new docs to firestore collection\n//remove docs from firestore collection\n\nimport { useReducer, useEffect, useState,  } from \"react\";\nimport { projectFirestore, timestamp } from '../firebase/config'\n\nlet initialState = {\n    document: null,\n    isPending: false,\n    error: null,\n    success: null\n\n}\n\nconst firestoreReducer = (state, action) => {\n    switch (action.type) {\n\n        //add cases to update state\n        case 'IS_PENDING': \n            return { isPending: true, document: null, success: false, error: null }\n        case 'ADDED_DOC':\n            return { isPending: false, document: action.payload, success: true, error: null }\n        \n        case 'DELETED_DOCUMENT':\n            return { isPending: false, document: null, success: true, error: null}\n        case 'ERROR':\n            return { isPending: false, document: null, success: false, error: action.payload }\n        \n        default: \n        return state\n    }\n\n}\n\nexport const useFirestore = (collection) => {\n\n    const [ response, dispatch ] = useReducer(firestoreReducer, initialState ) // response = state\n    const [ isCancelled, setIsCancelled ] = useState(false) // for cleanup function on unmount\n\n    //ref: collection - to be used for both adding and deleting\n\n    const ref = projectFirestore.collection(collection)\n\n    // to dispatch if isCancelled is false: \n\n    const dispatchIfNotCancelled = (action) => {\n        if(!isCancelled) { \n            dispatch(action)\n        }\n    }\n\n    // add doc:\n    const addDocument = async (doc) => {\n        dispatch({type: 'IS_PENDING'}) // no data = no payload req\n        try {\n            const createdAt = timestamp.fromDate(new Date())\n            const addedDocument = await ref.add({...doc, createdAt})\n            dispatchIfNotCancelled({ type: 'ADDED_DOC', payload: addedDocument })\n        }\n        catch (err) {\n            dispatchIfNotCancelled({ type: 'ERROR', payload: err.message})\n\n        }\n    }\n\n    // delete doc:\n\n    const deleteDocument = async (id) => {\n        dispatch({ type: \"IS_PENDING\"})\n\n        try {\n            await ref.doc(id).delete()\n            dispatchIfNotCancelled({ type: 'DELETED_DOCUMENT' })\n        }\n        catch (err)  {\n            dispatchIfNotCancelled({type: 'ERROR', payload: 'Could not delete'})\n        }\n    }\n\n    // cleanup function\n\n    useEffect(()=> { \n        return () => {\n        setIsCancelled(true)\n    }\n\n    }, []) // only runs on mount due to empty dep array\n\n    return { addDocument, deleteDocument, response }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}
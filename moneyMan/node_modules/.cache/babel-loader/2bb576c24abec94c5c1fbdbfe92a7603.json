{"ast":null,"code":"import _objectSpread from\"/home/dnlstronge/ReactP/moneyMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/dnlstronge/ReactP/moneyMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/dnlstronge/ReactP/moneyMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState,useRef}from\"react\";import{projectFirestore}from\"../firebase/config\";export var useCollection=function useCollection(collection,_query,_orderBy){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),documents=_useState2[0],setDocuments=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];// fixes issue cause by using an array inside dep array (inf loop)\n// \"_query\" is \"different\" and causes inf loop if used directly in dependency array\nvar query=useRef(_query).current;var orderBy=useRef(_orderBy).current;useEffect(function(){var ref=projectFirestore.collection(collection);// add where\nif(query){var _ref;ref=(_ref=ref).where.apply(_ref,_toConsumableArray(query));}if(orderBy){var _ref2;ref=(_ref2=ref).orderBy.apply(_ref2,_toConsumableArray(orderBy));}var unsubscribe=ref.onSnapshot(function(snapshot){var results=[];snapshot.docs.forEach(function(doc){results.push(_objectSpread(_objectSpread({},doc.data()),{},{id:doc.id}));});// updates state\nsetDocuments(results);setError(null);},function(error){console.log(error);setError('Could not fetch data');});// cleanup/unsub\nreturn function(){return unsubscribe();};},[collection,query,orderBy]);return{documents:documents,error:error};};// Houston we have Problem: would this not cause infinite cycle of rerender\n// due to an array reference type? i.e JS will see query as different and because\n// there is a diff to something in the dep array useEffect would fire again and again......\n// useRef to get arround this? rename query and wrap using useref, store that in var called query","map":{"version":3,"names":["useEffect","useState","useRef","projectFirestore","useCollection","collection","_query","_orderBy","documents","setDocuments","error","setError","query","current","orderBy","ref","where","unsubscribe","onSnapshot","snapshot","results","docs","forEach","doc","push","data","id","console","log"],"sources":["/home/dnlstronge/ReactP/moneyMan/src/hooks/useCollection.js"],"sourcesContent":["import { useEffect, useState, useRef } from \"react\"\nimport { projectFirestore } from \"../firebase/config\"\n\n\nexport const useCollection = (collection, _query, _orderBy) => {\n    const [ documents, setDocuments ] = useState(null)\n    const [ error, setError ] = useState(null)\n\n// fixes issue cause by using an array inside dep array (inf loop)\n// \"_query\" is \"different\" and causes inf loop if used directly in dependency array\n\n    const query = useRef(_query).current\n    const orderBy = useRef(_orderBy).current\n\n\n    useEffect(() => {\n        let ref = projectFirestore.collection(collection)\n// add where\n\n        if (query) {\n            ref = ref.where(...query)\n        }\n        if (orderBy) {\n            ref = ref.orderBy(...orderBy)\n        }\n\n        const unsubscribe = ref.onSnapshot( (snapshot) => {\n            let results = []\n            snapshot.docs.forEach( doc => {\n                results.push({...doc.data(), id: doc.id })\n            })\n\n            // updates state\n            setDocuments(results)\n            setError(null)\n        }, (error) => {\n            console.log(error)\n            setError('Could not fetch data')\n        })\n            // cleanup/unsub\n        \n            return () => unsubscribe()\n\n\n    }, [collection, query, orderBy])\n\n    return {documents, error}\n}\n\n// Houston we have Problem: would this not cause infinite cycle of rerender\n// due to an array reference type? i.e JS will see query as different and because\n// there is a diff to something in the dep array useEffect would fire again and again......\n// useRef to get arround this? rename query and wrap using useref, store that in var called query"],"mappings":"4cAAA,OAASA,SAAS,CAAEC,QAAQ,CAAEC,MAAM,KAAQ,OAAO,CACnD,OAASC,gBAAgB,KAAQ,oBAAoB,CAGrD,MAAO,IAAMC,cAAa,CAAG,QAAhBA,cAAa,CAAIC,UAAU,CAAEC,MAAM,CAAEC,QAAQ,CAAK,CAC3D,cAAoCN,QAAQ,CAAC,IAAI,CAAC,wCAA1CO,SAAS,eAAEC,YAAY,eAC/B,eAA4BR,QAAQ,CAAC,IAAI,CAAC,yCAAlCS,KAAK,eAAEC,QAAQ,eAE3B;AACA;AAEI,GAAMC,MAAK,CAAGV,MAAM,CAACI,MAAM,CAAC,CAACO,OAAO,CACpC,GAAMC,QAAO,CAAGZ,MAAM,CAACK,QAAQ,CAAC,CAACM,OAAO,CAGxCb,SAAS,CAAC,UAAM,CACZ,GAAIe,IAAG,CAAGZ,gBAAgB,CAACE,UAAU,CAACA,UAAU,CAAC,CACzD;AAEQ,GAAIO,KAAK,CAAE,UACPG,GAAG,CAAG,MAAAA,GAAG,EAACC,KAAK,+BAAIJ,KAAK,EAAC,CAC7B,CACA,GAAIE,OAAO,CAAE,WACTC,GAAG,CAAG,OAAAA,GAAG,EAACD,OAAO,gCAAIA,OAAO,EAAC,CACjC,CAEA,GAAMG,YAAW,CAAGF,GAAG,CAACG,UAAU,CAAE,SAACC,QAAQ,CAAK,CAC9C,GAAIC,QAAO,CAAG,EAAE,CAChBD,QAAQ,CAACE,IAAI,CAACC,OAAO,CAAE,SAAAC,GAAG,CAAI,CAC1BH,OAAO,CAACI,IAAI,gCAAKD,GAAG,CAACE,IAAI,EAAE,MAAEC,EAAE,CAAEH,GAAG,CAACG,EAAE,GAAG,CAC9C,CAAC,CAAC,CAEF;AACAjB,YAAY,CAACW,OAAO,CAAC,CACrBT,QAAQ,CAAC,IAAI,CAAC,CAClB,CAAC,CAAE,SAACD,KAAK,CAAK,CACViB,OAAO,CAACC,GAAG,CAAClB,KAAK,CAAC,CAClBC,QAAQ,CAAC,sBAAsB,CAAC,CACpC,CAAC,CAAC,CACE;AAEA,MAAO,kBAAMM,YAAW,EAAE,GAGlC,CAAC,CAAE,CAACZ,UAAU,CAAEO,KAAK,CAAEE,OAAO,CAAC,CAAC,CAEhC,MAAO,CAACN,SAAS,CAATA,SAAS,CAAEE,KAAK,CAALA,KAAK,CAAC,CAC7B,CAAC,CAED;AACA;AACA;AACA"},"metadata":{},"sourceType":"module"}